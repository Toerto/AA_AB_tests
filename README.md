A/A, A/B tests with CUPED methods

Эксперимент 1. Подготовка корректного дизайна A/B теста для данных о покупках в магазине. Клиенты осуществляют покупки раз в 10 дней. Есть исторические данные - user_id, metric(средний чек), day.


Задача – установить, можно ли статистически значимо обнаружить эффект в 2% и за какой срок

- В ходе изучения данных благодаря тесту Шапиро-Уилка и QQ-plot было установлено, что данные имеют ненормальное распределение. Выбираем непараметрические критерии проверки гипотез.
- Осуществляем деление данных на период обучения (1-й день покупки клиента) и период теста (2-й день покупки клиента).
- Проводим отбор похожих групп А и В по критериям однородности (Манна-Уитни, Колмогорова-Смирнова). Оцениваем эффективность по критериям Манна-Уитни, перестановочному критерию и бутстрепу.
- Оцениваем мощности критериев.Добавляем в целевую метрику одной из групп эффект в размере 2%. Наилучший результат на периоде в 10 дней показал критерий Манна-Уитни.
- Сокращаем срок проведения теста и получаем сведения о том, что критерий теряет необходимый уровень мощности и способность статистически значимо обнаруживать эффект в 2% на продолжительности теста в 4 дня.
- Для увеличения мощности критерия воспользуемся методом уменьшения вариации при сохранении матожидания CUPED. Получаем мощность критерия на 2 днях в размере 0,97. Если бы мощность была недостаточной можно было бы дополнительно воспользоваться ранговым преобразованием.



Эксперимент 2. Анализ результатов проведенного А/В теста. Данные собраны по результату тестирования гипотезы о статистически значимом увеличении продолжительности проведения времени игроков в игре при введении уведомления о необходимости сделать перерыв или осуществить внутриигровую покупку. В группе А уведомление появлялось на 30-м уровне, в группе В - на 40-м. 

- После подготовки данных видим, что из 90189 уникальных пользователей 3994 пользователя установили, но не играли в игру, а большинство игроков сыграли только в начальные уровни и не продвинулись дальше.
- Смотрим на абсолютные значения и пропорции метрики в группах.
- Проверим, есть ли статистически значимая разница между группами, продолжившим играть после 1 и 7 дня. Данные имеют ненормальное распределение. Используем t-критерий Стьюдента для проверки Н0. 
- p-value меньше уровня значимости, отвергаем нулевую гипотезу, группы не одинаковы, есть статистически значимая разница. Уровень retention ratio выше в группе А (gate_30) выше. Разница в метрике не столь высока. Возможно, необходимо больше данных или уделить больше внимания при дизайне A/B теста.
